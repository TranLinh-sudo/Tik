--[[ 
    CẤU HÌNH LIÊN KẾT
    Thay link Server của bạn vào đây (Nhớ đuôi /api/update)
]]
local SERVER_URL = "https://c0c5f5180cb349.lhr.life/api/update" 

-------------------------------------------------------------
-- CODE CHẠY NGẦM (KHÔNG ĐỤNG CHẠM AUTO FARM)
-------------------------------------------------------------
task.spawn(function() -- Lệnh này giúp script chạy song song
    local HttpService = game:GetService("HttpService")
    local Players = game:GetService("Players")
    local LocalPlayer = Players.LocalPlayer
    
    -- Đợi game load xong hẳn mới chạy để tránh lỗi
    repeat task.wait() until game:IsLoaded() and LocalPlayer and LocalPlayer:FindFirstChild("Data")

    -- Hàm gửi HTTP an toàn
    local request = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request
    if not request then return end -- Nếu Executor dỏm quá thì thôi

    -- Danh sách trái xịn cần báo cáo
    local RICH_FRUITS = {
        ["Kitsune"]=true, ["Dragon"]=true, ["Leopard"]=true, ["Dough"]=true, 
        ["T-Rex"]=true, ["Mammoth"]=true, ["Spirit"]=true, ["Venom"]=true, 
        ["Control"]=true, ["Shadow"]=true, ["Blizzard"]=true, ["Pain"]=true, 
        ["Rumble"]=true, ["Portal"]=true, ["Phoenix"]=true, ["Sound"]=true, 
        ["Spider"]=true, ["Love"]=true, ["Buddha"]=true, ["Quake"]=true
    }

    local function getInventory()
        local list = {}
        pcall(function()
            local raw = game:GetService("ReplicatedStorage").Remotes["CommF_"]:InvokeServer("getInventory")
            for _, v in pairs(raw) do
                if v.Type == "Blox Fruit" then
                    local name = string.match(v.Name, "^(.-)-") or v.Name
                    if RICH_FRUITS[name] then table.insert(list, name) end
                end
            end
        end)
        return table.concat(list, ", ")
    end

    -- Vòng lặp gửi tin (5 giây/lần)
    while true do
        pcall(function()
            local data = LocalPlayer:FindFirstChild("Data")
            if data then
                local payload = {
                    -- ID Duy nhất để phân biệt nhiều acc (Dùng Tên đăng nhập)
                    id = LocalPlayer.Name, 
                    displayName = LocalPlayer.DisplayName .. " (Lv." .. data.Level.Value .. ")",
                    data = {
                        level = data.Level.Value,
                        beli = data.Beli.Value,
                        fragments = data.Fragments.Value,
                        inventory = getInventory()
                    }
                }

                request({
                    Url = SERVER_URL,
                    Method = "POST",
                    Headers = { ["Content-Type"] = "application/json" },
                    Body = HttpService:JSONEncode(payload)
                })
            end
        end)
        task.wait(5) -- Nghỉ 5 giây rồi gửi tiếp
    end
end)

-- THÔNG BÁO NHẸ
game.StarterGui:SetCore("SendNotification", {
    Title = "System",
    Text = "Đã bật theo dõi ngầm!",
    Duration = 3
})
